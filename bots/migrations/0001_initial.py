# Generated by Django 5.1.12 on 2025-11-06 14:36

import bots.models
import concurrency.fields
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('accounts', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Bot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('name', models.CharField(default='My bot', max_length=255)),
                ('meeting_url', models.CharField(max_length=511)),
                ('meeting_uuid', models.CharField(blank=True, max_length=511, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', concurrency.fields.IntegerVersionField(default=0, help_text='record revision number')),
                ('state', models.IntegerField(choices=[(1, 'Ready'), (2, 'Joining'), (3, 'Joined - Not Recording'), (4, 'Joined - Recording'), (5, 'Leaving'), (6, 'Post Processing'), (7, 'Fatal Error'), (8, 'Waiting Room'), (9, 'Ended'), (10, 'Data Deleted'), (11, 'Scheduled'), (12, 'Staged'), (13, 'Joined - Recording Paused'), (14, 'Joining Breakout Room'), (15, 'Leaving Breakout Room'), (16, 'Joined - Recording Permission Denied')], default=1)),
                ('settings', models.JSONField(default=dict)),
                ('metadata', models.JSONField(blank=True, null=True)),
                ('first_heartbeat_timestamp', models.IntegerField(blank=True, null=True)),
                ('last_heartbeat_timestamp', models.IntegerField(blank=True, null=True)),
                ('join_at', models.DateTimeField(blank=True, help_text='The time the bot should join the meeting', null=True)),
                ('deduplication_key', models.CharField(blank=True, help_text='Optional key for deduplicating bots', max_length=1024, null=True)),
            ],
        ),
        migrations.CreateModel(
            name='Calendar',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('platform', models.CharField(choices=[('google', 'Google'), ('microsoft', 'Microsoft')], max_length=255)),
                ('state', models.IntegerField(choices=[(1, 'Connected'), (2, 'Disconnected')], default=1)),
                ('connection_failure_data', models.JSONField(default=None, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version', concurrency.fields.IntegerVersionField(default=0, help_text='record revision number')),
                ('metadata', models.JSONField(blank=True, null=True)),
                ('deduplication_key', models.CharField(blank=True, help_text='Optional key for deduplicating calendars', max_length=1024, null=True)),
                ('client_id', models.CharField(max_length=255)),
                ('platform_uuid', models.CharField(blank=True, max_length=1024, null=True)),
                ('last_attempted_sync_at', models.DateTimeField(blank=True, null=True)),
                ('last_successful_sync_at', models.DateTimeField(blank=True, null=True)),
                ('last_successful_sync_time_window_start', models.DateTimeField(blank=True, null=True)),
                ('last_successful_sync_time_window_end', models.DateTimeField(blank=True, null=True)),
                ('last_successful_sync_started_at', models.DateTimeField(blank=True, null=True)),
                ('sync_task_enqueued_at', models.DateTimeField(blank=True, null=True)),
                ('sync_task_requested_at', models.DateTimeField(blank=True, null=True)),
                ('_encrypted_data', models.BinaryField(null=True)),
            ],
        ),
        migrations.CreateModel(
            name='MediaBlob',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('blob', models.BinaryField()),
                ('content_type', models.CharField(choices=[('audio/mp3', 'MP3 Audio'), ('image/png', 'PNG Image')], max_length=255)),
                ('checksum', models.CharField(editable=False, max_length=64)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('duration_ms', models.IntegerField()),
            ],
        ),
        migrations.CreateModel(
            name='BotChatMessageRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('to_user_uuid', models.CharField(blank=True, max_length=255, null=True)),
                ('to', models.CharField(choices=[('everyone', 'Everyone'), ('specific_user', 'Specific User'), ('everyone_but_host', 'Everyone But Host')])),
                ('message', models.TextField()),
                ('additional_data', models.JSONField(default=dict)),
                ('state', models.IntegerField(choices=[(1, 'Enqueued'), (2, 'Sent'), (3, 'Failed')], default=1)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('sent_at_timestamp_ms', models.BigIntegerField(blank=True, null=True)),
                ('failure_data', models.JSONField(default=None, null=True)),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_message_requests', to='bots.bot')),
            ],
        ),
        migrations.CreateModel(
            name='BotEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('old_state', models.IntegerField(choices=[(1, 'Ready'), (2, 'Joining'), (3, 'Joined - Not Recording'), (4, 'Joined - Recording'), (5, 'Leaving'), (6, 'Post Processing'), (7, 'Fatal Error'), (8, 'Waiting Room'), (9, 'Ended'), (10, 'Data Deleted'), (11, 'Scheduled'), (12, 'Staged'), (13, 'Joined - Recording Paused'), (14, 'Joining Breakout Room'), (15, 'Leaving Breakout Room'), (16, 'Joined - Recording Permission Denied')])),
                ('new_state', models.IntegerField(choices=[(1, 'Ready'), (2, 'Joining'), (3, 'Joined - Not Recording'), (4, 'Joined - Recording'), (5, 'Leaving'), (6, 'Post Processing'), (7, 'Fatal Error'), (8, 'Waiting Room'), (9, 'Ended'), (10, 'Data Deleted'), (11, 'Scheduled'), (12, 'Staged'), (13, 'Joined - Recording Paused'), (14, 'Joining Breakout Room'), (15, 'Leaving Breakout Room'), (16, 'Joined - Recording Permission Denied')])),
                ('event_type', models.IntegerField(choices=[(1, 'Bot Put in Waiting Room'), (2, 'Bot Joined Meeting'), (3, 'Bot Recording Permission Granted'), (4, 'Meeting Ended'), (5, 'Bot Left Meeting'), (6, 'Bot requested to join meeting'), (7, 'Bot Encountered Fatal error'), (8, 'Bot requested to leave meeting'), (9, 'Bot could not join meeting'), (10, 'Post Processing Completed'), (11, 'Data Deleted'), (12, 'Bot staged'), (13, 'Recording Paused'), (14, 'Recording Resumed'), (15, 'Bot joined breakout room'), (16, 'Bot left breakout room'), (17, 'Bot began joining breakout room'), (18, 'Bot began leaving breakout room'), (19, 'Bot recording permission denied')])),
                ('event_sub_type', models.IntegerField(choices=[(1, 'Bot could not join meeting - Meeting Not Started - Waiting for Host'), (2, 'Fatal error - Process Terminated'), (3, 'Bot could not join meeting - Zoom Authorization Failed'), (4, 'Bot could not join meeting - Zoom Meeting Status Failed'), (5, 'Bot could not join meeting - Unpublished Zoom Apps cannot join external meetings. See https://developers.zoom.us/docs/distribute/sdk-feature-review-requirements/'), (6, 'Fatal error - RTMP Connection Failed'), (7, 'Bot could not join meeting - Zoom SDK Internal Error'), (8, 'Fatal error - UI Element Not Found'), (9, 'Bot could not join meeting - Request to join denied'), (10, 'Leave requested - User requested'), (11, 'Leave requested - Auto leave silence'), (12, 'Leave requested - Auto leave only participant in meeting'), (13, 'Fatal error - Heartbeat timeout'), (14, 'Bot could not join meeting - Meeting not found'), (15, 'Fatal error - Bot not launched'), (16, 'Bot could not join meeting - Waiting room timeout exceeded'), (17, 'Leave requested - Auto leave max uptime exceeded'), (18, 'Bot could not join meeting - Login required. Use signed in bots: https://docs.attendee.dev/guides/signed-in-bots to resolve.'), (19, 'Bot could not join meeting - Bot login attempt failed'), (20, 'Fatal error - Out of credits'), (21, 'Bot could not join meeting - Unable to connect to meeting. This usually means the meeting password in the URL is incorrect.'), (22, 'Fatal error - Attendee internal error'), (23, 'Bot recording permission denied - Host denied permission'), (24, 'Bot recording permission denied - Request timed out'), (25, 'Bot recording permission denied - Host client cannot grant permission')], null=True)),
                ('metadata', models.JSONField(default=dict)),
                ('requested_bot_action_taken_at', models.DateTimeField(blank=True, null=True)),
                ('version', concurrency.fields.IntegerVersionField(default=0, help_text='record revision number')),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bot_events', to='bots.bot')),
            ],
            options={
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='BotDebugScreenshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('metadata', models.JSONField(default=dict)),
                ('file', models.FileField(storage=bots.models.BotDebugScreenshotStorage(), upload_to='')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('bot_event', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='debug_screenshots', to='bots.botevent')),
            ],
        ),
        migrations.CreateModel(
            name='BotResourceSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('data', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='resource_snapshots', to='bots.bot')),
            ],
        ),
        migrations.CreateModel(
            name='CalendarEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=255, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('platform_uuid', models.CharField(max_length=1024)),
                ('meeting_url', models.CharField(blank=True, max_length=511, null=True)),
                ('start_time', models.DateTimeField()),
                ('end_time', models.DateTimeField()),
                ('is_deleted', models.BooleanField(default=False)),
                ('attendees', models.JSONField(blank=True, null=True)),
                ('ical_uid', models.CharField(blank=True, max_length=1024, null=True)),
                ('name', models.CharField(blank=True, max_length=1024, null=True)),
                ('raw', models.JSONField()),
                ('calendar', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='bots.calendar')),
            ],
        ),
        migrations.AddField(
            model_name='bot',
            name='calendar_event',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='bots', to='bots.calendarevent'),
        ),
        migrations.CreateModel(
            name='CreditTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('centicredits_before', models.IntegerField()),
                ('centicredits_after', models.IntegerField()),
                ('centicredits_delta', models.IntegerField()),
                ('stripe_payment_intent_id', models.CharField(blank=True, max_length=255, null=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('bot', models.ForeignKey(null=True, on_delete=django.db.models.deletion.PROTECT, related_name='credit_transactions', to='bots.bot')),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='credit_transactions', to='accounts.organization')),
                ('parent_transaction', models.ForeignKey(null=True, on_delete=django.db.models.deletion.PROTECT, related_name='child_transactions', to='bots.credittransaction')),
            ],
        ),
        migrations.CreateModel(
            name='BotMediaRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text_to_speak', models.TextField(blank=True, null=True)),
                ('text_to_speech_settings', models.JSONField(default=None, null=True)),
                ('media_url', models.URLField(blank=True, null=True)),
                ('media_type', models.IntegerField(choices=[(1, 'Image'), (2, 'Audio'), (3, 'Video')])),
                ('state', models.IntegerField(choices=[(1, 'Enqueued'), (2, 'Playing'), (3, 'Dropped'), (4, 'Finished'), (5, 'Failed to Play')], default=1)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='media_requests', to='bots.bot')),
                ('media_blob', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='bot_media_requests', to='bots.mediablob')),
            ],
        ),
        migrations.CreateModel(
            name='Participant',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.CharField(max_length=255)),
                ('user_uuid', models.CharField(blank=True, max_length=255, null=True)),
                ('full_name', models.CharField(blank=True, max_length=255, null=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('object_id', models.CharField(blank=True, editable=False, max_length=255, null=True, unique=True)),
                ('is_the_bot', models.BooleanField(db_default=False, default=False)),
                ('is_host', models.BooleanField(db_default=False, default=False)),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='participants', to='bots.bot')),
            ],
        ),
        migrations.CreateModel(
            name='ChatMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('to', models.IntegerField(choices=[(1, 'only_bot'), (2, 'everyone')])),
                ('timestamp', models.IntegerField()),
                ('additional_data', models.JSONField(default=dict)),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('source_uuid', models.CharField(max_length=255, null=True, unique=True)),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_messages', to='bots.bot')),
                ('participant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_messages', to='bots.participant')),
            ],
        ),
        migrations.CreateModel(
            name='ParticipantEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.IntegerField(choices=[(1, 'Join'), (2, 'Leave')])),
                ('object_id', models.CharField(editable=False, max_length=255, unique=True)),
                ('event_data', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('timestamp_ms', models.BigIntegerField()),
                ('participant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='bots.participant')),
            ],
        ),
        migrations.CreateModel(
            name='Project',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='projects', to='accounts.organization')),
            ],
        ),
        migrations.AddField(
            model_name='mediablob',
            name='project',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='media_blobs', to='bots.project'),
        ),
        migrations.CreateModel(
            name='Credentials',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('credential_type', models.IntegerField(choices=[(1, 'Deepgram'), (2, 'Zoom OAuth'), (3, 'Google Text To Speech'), (4, 'Gladia'), (5, 'OpenAI'), (6, 'Assembly AI'), (7, 'Sarvam'), (8, 'Teams Bot Login'), (9, 'External Media Storage'), (10, 'ElevenLabs')])),
                ('_encrypted_data', models.BinaryField(null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='credentials', to='bots.project')),
            ],
        ),
        migrations.AddField(
            model_name='calendar',
            name='project',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='calendars', to='bots.project'),
        ),
        migrations.AddField(
            model_name='bot',
            name='project',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='bots', to='bots.project'),
        ),
        migrations.CreateModel(
            name='ApiKey',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('key_hash', models.CharField(max_length=64, unique=True)),
                ('disabled_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='api_keys', to='bots.project')),
            ],
        ),
        migrations.CreateModel(
            name='ProjectAccess',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='project_accesses', to='bots.project')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='project_accesses', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Recording',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('recording_type', models.IntegerField(choices=[(1, 'Audio and Video'), (2, 'Audio Only'), (3, 'No Recording')])),
                ('transcription_type', models.IntegerField(choices=[(1, 'Non realtime'), (2, 'Realtime'), (3, 'No Transcription')])),
                ('is_default_recording', models.BooleanField(default=False)),
                ('file_name', models.CharField(max_length=255)),
                ('state', models.IntegerField(choices=[(1, 'Not Started'), (2, 'In Progress'), (3, 'Complete'), (4, 'Failed'), (5, 'Paused')], default=1)),
                ('transcription_state', models.IntegerField(choices=[(1, 'Not Started'), (2, 'In Progress'), (3, 'Complete'), (4, 'Failed')], default=1)),
                ('transcription_failure_data', models.JSONField(default=None, null=True)),
                ('transcription_provider', models.IntegerField(blank=True, choices=[(1, 'Deepgram'), (2, 'Closed Caption From Platform'), (3, 'Gladia'), (4, 'OpenAI'), (5, 'Assembly AI'), (6, 'Sarvam'), (7, 'ElevenLabs')], null=True)),
                ('version', concurrency.fields.IntegerVersionField(default=0, help_text='record revision number')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('first_buffer_timestamp_ms', models.BigIntegerField(blank=True, null=True)),
                ('file', models.FileField(storage=bots.models.RecordingStorage(), upload_to='')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('bot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recordings', to='bots.bot')),
            ],
        ),
        migrations.CreateModel(
            name='AudioChunk',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('audio_blob', models.BinaryField()),
                ('audio_format', models.IntegerField(choices=[(1, 'PCM'), (2, 'MP3')], default=1)),
                ('timestamp_ms', models.BigIntegerField()),
                ('duration_ms', models.IntegerField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('sample_rate', models.IntegerField()),
                ('source', models.IntegerField(choices=[(1, 'Per Participant Audio'), (2, 'Mixed Audio')], default=1)),
                ('participant', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='audio_chunks', to='bots.participant')),
                ('recording', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audio_chunks', to='bots.recording')),
            ],
        ),
        migrations.CreateModel(
            name='AsyncTranscription',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('state', models.IntegerField(choices=[(1, 'Not Started'), (2, 'In Progress'), (3, 'Complete'), (4, 'Failed')], default=1)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('failed_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('settings', models.JSONField(default=dict)),
                ('failure_data', models.JSONField(default=None, null=True)),
                ('version', concurrency.fields.IntegerVersionField(default=0, help_text='record revision number')),
                ('recording', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='async_transcriptions', to='bots.recording')),
            ],
        ),
        migrations.CreateModel(
            name='Utterance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('timestamp_ms', models.BigIntegerField()),
                ('duration_ms', models.IntegerField()),
                ('transcription', models.JSONField(default=None, null=True)),
                ('transcription_attempt_count', models.IntegerField(default=0)),
                ('failure_data', models.JSONField(default=None, null=True)),
                ('source_uuid', models.CharField(max_length=255, null=True, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('source', models.IntegerField(choices=[(1, 'Per Participant Audio'), (2, 'Closed Caption From Platform')], default=1)),
                ('audio_blob', models.BinaryField()),
                ('audio_format', models.IntegerField(choices=[(1, 'PCM'), (2, 'MP3')], default=1, null=True)),
                ('sample_rate', models.IntegerField(default=None, null=True)),
                ('async_transcription', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='utterances', to='bots.asynctranscription')),
                ('audio_chunk', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='utterances', to='bots.audiochunk')),
                ('participant', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='utterances', to='bots.participant')),
                ('recording', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='utterances', to='bots.recording')),
            ],
        ),
        migrations.CreateModel(
            name='WebhookSecret',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('_secret', models.BinaryField(null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='webhook_secrets', to='bots.project')),
            ],
        ),
        migrations.CreateModel(
            name='WebhookSubscription',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_id', models.CharField(editable=False, max_length=32, unique=True)),
                ('url', models.URLField()),
                ('triggers', models.JSONField(default=bots.models.WebhookSubscription.default_triggers)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('bot', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='bot_webhook_subscriptions', to='bots.bot')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='webhook_subscriptions', to='bots.project')),
            ],
        ),
        migrations.CreateModel(
            name='WebhookDeliveryAttempt',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('webhook_trigger_type', models.IntegerField(choices=[(1, 'Bot State Change'), (2, 'Transcript Update'), (3, 'Chat Messages Update'), (4, 'Participant Join/Leave'), (5, 'Calendar Events Update'), (6, 'Calendar State Change'), (7, 'Async Transcription State Change')], default=1)),
                ('idempotency_key', models.UUIDField(editable=False, unique=True)),
                ('payload', models.JSONField(default=dict)),
                ('status', models.IntegerField(choices=[(1, 'Pending'), (2, 'Success'), (3, 'Failure')], default=1)),
                ('attempt_count', models.IntegerField(default=0)),
                ('last_attempt_at', models.DateTimeField(blank=True, null=True)),
                ('succeeded_at', models.DateTimeField(blank=True, null=True)),
                ('response_body_list', models.JSONField(default=list)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('bot', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='webhook_delivery_attempts', to='bots.bot')),
                ('calendar', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='webhook_delivery_attempts', to='bots.calendar')),
                ('webhook_subscription', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='webhookdelivery_attempts', to='bots.webhooksubscription')),
            ],
        ),
        migrations.AddConstraint(
            model_name='botevent',
            constraint=models.CheckConstraint(condition=models.Q(models.Q(('event_type', 7), models.Q(('event_sub_type', 2), ('event_sub_type', 22), ('event_sub_type', 20), ('event_sub_type', 6), ('event_sub_type', 8), ('event_sub_type', 13), ('event_sub_type', 15), _connector='OR')), models.Q(('event_type', 9), models.Q(('event_sub_type', 1), ('event_sub_type', 21), ('event_sub_type', 16), ('event_sub_type', 3), ('event_sub_type', 18), ('event_sub_type', 19), ('event_sub_type', 4), ('event_sub_type', 5), ('event_sub_type', 7), ('event_sub_type', 9), ('event_sub_type', 14), _connector='OR')), models.Q(('event_type', 8), models.Q(('event_sub_type', 10), ('event_sub_type', 11), ('event_sub_type', 12), ('event_sub_type', 17), ('event_sub_type__isnull', True), _connector='OR')), models.Q(('event_type', 19), models.Q(('event_sub_type', 23), ('event_sub_type', 24), ('event_sub_type', 25), _connector='OR')), models.Q(models.Q(('event_type', 7), _negated=True), models.Q(('event_type', 9), _negated=True), models.Q(('event_type', 8), _negated=True), ('event_sub_type__isnull', True)), _connector='OR'), name='valid_event_type_event_sub_type_combinations'),
        ),
        migrations.AddConstraint(
            model_name='calendarevent',
            constraint=models.UniqueConstraint(fields=('calendar', 'platform_uuid'), name='unique_calendar_event_platform_uuid'),
        ),
        migrations.AddConstraint(
            model_name='credittransaction',
            constraint=models.UniqueConstraint(condition=models.Q(('parent_transaction__isnull', False)), fields=('parent_transaction',), name='unique_child_transaction'),
        ),
        migrations.AddConstraint(
            model_name='credittransaction',
            constraint=models.UniqueConstraint(condition=models.Q(('parent_transaction__isnull', True)), fields=('organization',), name='unique_root_transaction'),
        ),
        migrations.AddConstraint(
            model_name='credittransaction',
            constraint=models.UniqueConstraint(condition=models.Q(('bot__isnull', False)), fields=('bot',), name='unique_bot_transaction'),
        ),
        migrations.AddConstraint(
            model_name='credittransaction',
            constraint=models.UniqueConstraint(condition=models.Q(('stripe_payment_intent_id__isnull', False)), fields=('stripe_payment_intent_id',), name='unique_stripe_payment_intent_id'),
        ),
        migrations.AddConstraint(
            model_name='botmediarequest',
            constraint=models.UniqueConstraint(condition=models.Q(('state', 2)), fields=('bot', 'media_type'), name='unique_playing_media_request_per_bot_and_type'),
        ),
        migrations.AddConstraint(
            model_name='participant',
            constraint=models.UniqueConstraint(fields=('bot', 'uuid'), name='unique_participant_per_bot'),
        ),
        migrations.AddConstraint(
            model_name='mediablob',
            constraint=models.UniqueConstraint(fields=('project', 'checksum'), name='unique_project_blob'),
        ),
        migrations.AddConstraint(
            model_name='credentials',
            constraint=models.UniqueConstraint(fields=('project', 'credential_type'), name='unique_project_credentials'),
        ),
        migrations.AddConstraint(
            model_name='calendar',
            constraint=models.UniqueConstraint(fields=('project', 'deduplication_key'), name='unique_calendar_deduplication_key'),
        ),
        migrations.AddIndex(
            model_name='bot',
            index=models.Index(condition=models.Q(('join_at__isnull', False)), fields=['join_at'], name='bot_join_at_idx'),
        ),
        migrations.AddConstraint(
            model_name='bot',
            constraint=models.UniqueConstraint(condition=models.Q(('state__in', [7, 9, 10]), _negated=True), fields=('project', 'deduplication_key'), name='unique_bot_deduplication_key'),
        ),
    ]
